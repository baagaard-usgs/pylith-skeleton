# Default settings for the PyLith application.

# -----------------------------------------------------------------------------
# Journals
# -----------------------------------------------------------------------------
journal:
  channels:
    - info, application-flow
    - info, application-flow-self
    - warning, user-input
    - warning, deprecation
    - error, user-input
    - firewall, internal-error
    - debug, mms-test
    - debug, application-flow
    - debug, auxiliary-fields
    - debug, integration-kernels
    - debug, solver
    - debug, mesh
    - warning, ":TODO:"

# -----------------------------------------------------------------------------
# Mesh initialization
# -----------------------------------------------------------------------------

# Default mesh initialization phases; assumes reading mesh in serial.
pylith.app.problem.mesh_initializer.phases:
  - reader#read_mesh
  - reordering#reorder_mesh
  - distributor#distribute_mesh
  - insert_interfaces#insert_interfaces
  - refiner#refine_mesh

# Mesh initialization phases when reading a mesh in parallel.
# :TODO: Describe how to set the component name.
pylith.mesh_initializers.mesh_initializer#parallel_initializer:
  phases:
    - reader#read_mesh
    - distributor#distribute_mesh
    - insert_interfaces#insert_interfaces
    - refiner#refine_mesh

# -----------------------------------------------------------------------------
# General PETSc options
# -----------------------------------------------------------------------------
# Need this to be a dictionary in order to make it easy to disable/enable..
pylith.app.petsc_options:
  testing:
    enabled: False
    options:
      - malloc_debug
  collective_io:
    enabled: True
    options:
      - viewer_hdf5_collective
  attach_debugger:
    enabled: False
    options:
      - stop_for_debugger
      - debugger_pause, 10
      - malloc_debug, False
      - check_pointer_intensity, False

# -----------------------------------------------------------------------------
# General solver related settings
# -----------------------------------------------------------------------------

pylith.app.problem.governing_eqn.solver.petsc_options:
  initial_guess:
    enabled: True
    options:
      - ksp_guess_type, pod
      - ksp_guess_pod_size,  8
  tolerances:
    enabled: True
    options:
      - ksp_rtol, 1.0e-12
      - ksp_atol, 1.0e-7

      - snes_rtol, 5.0e-6
      - snes_atol, 5.0e-2
  adaptive_ts:
    enabled: False
    options:
      - ts_adapt_type, basic
      - ts_adapt_safety, 0.2
      - ts_adapt_reject_safety, 0.1
      - ts_atol, 0.05
      - ts_rtol, 0.05

      - ts_adapt_monitor, true
  monitoring:
    enabled: False
    options:
      - ts_monitor
      - ksp_monitor
      - snes_monitor

      - ksp_converged_reason
      - snes_converged_reason

      - ts_error_if_step_fails
      - ksp_error_if_not_converged
      - snes_error_if_not_converged

# Does not work
#pylith.governing_eqns.solvers.elasticity_nofault.petsc_options.solver:
# Works
pylith.app.problem.governing_eqn.solver.petsc_options.solver:
  enabled: True
  options:
    - ts_type, beuler
    - pc_type, gamg

    - pc_gamg_coarse_eq_limit, 200
    - mg_fine_ksp_max_it, 5

# -----------------------------------------------------------------------------
# Governing equations
# -----------------------------------------------------------------------------
# Default is one material named `material`

pylith.governing_eqns.elasticity.materials:
  - elasticity#material

pylith.governing_eqns.incompressible_elasticity.materials:
  - incompressible_elasticity#material

pylith.governing_eqns.poroelasticity.materials:
  - poroelasticity#material
