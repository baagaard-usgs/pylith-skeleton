# Default settings for the PyLith application.

# -----------------------------------------------------------------------------
# Mesh initialization
# -----------------------------------------------------------------------------

# Default mesh initialization phases; assumes reading mesh in serial.
pylith.app.problem.mesh_initializer.phases:
  - reader#read_mesh
  - reordering#reorder_mesh
  - distributor#distribute_mesh
  - insert_interfaces#insert_interfaces
  - refiner#refine_mesh

# Mesh initialization phases when reading a mesh in parallel.
# :TODO: Describe how to set the component name.
pylith.mesh_initializers.mesh_initializer#parallel_initializer:
  phases:
    - reader#read_mesh
    - distributor#distribute_mesh
    - insert_interfaces#insert_interfaces
    - refiner#refine_mesh

# -----------------------------------------------------------------------------
# Solution fields
# -----------------------------------------------------------------------------

# Subfields
pylith.fields.subfields.basic#displacement:
  name: displacement
  scale: displacement
  vector_field_type: vector

pylith.fields.subfields.basic#velocity:
  name: velocity
  scale: velocity
  vector_field_type: vector

pylith.fields.subfields.basic#lagrange_multiplier_fault:
  name: lagrange_multiplier_fault
  scale: stress
  vector_field_type: vector

pylith.fields.subfields.basic#pressure:
  name: pressure
  scale: stress
  vector_field_type: scalar

pylith.fields.subfields.basic#fluid_pressure:
  name: fluid_pressure
  scale: stress
  vector_field_type: scalar

pylith.fields.subfields.basic#trace_strain:
  name: trace_strain
  scale: strain
  vector_field_type: scalar

# Default: Elasticity, no fault
pylith.app.problem.governing_eqn.solution:
  name: solution
  subfields:
    - basic#displacement
    - basic#velocity

# Elasticity, no fault
pylith.governing_eqns.elasticity#elasticity:
  solution.subfields:
    - pylith.fields.subfields.basic#displacement
    - pylith.fields.subfields.basic#velocity

# Elasticity + fault(s)
pylith.governing_eqns.elasticity#elasticity-fault:
  solution.subfields:
    - pylith.fields.subfields.basic#displacement
    - pylith.fields.subfields.basic#velocity
    - pylith.fields.subfields.basic#lagrange_multiplier_fault

# Incompressible elasticity, no fault
pylith.governing_eqns.incompressible_elasticity#incompressible_elasticity:
  - pylith.fields.subfields.basic#displacement
  - pylith.fields.subfields.basic#pressure

# Poroelasticity, no fault, no state variables
pylith.governing_eqns.poroelasticity#poroelasticity:
  - pylith.fields.subfields.basic#displacement
  - pylith.fields.subfields.basic#velocity
  - pylith.fields.subfields.basic#fluid_pressure
  - pylith.fields.subfields.basic#trace_strain

# Poroelasticity + fault, no state variables
pylith.governing_eqns.poroelasticity#poroelasticity-fault:
  - pylith.fields.subfields.basic#displacement
  - pylith.fields.subfields.basic#velocity
  - pylith.fields.subfields.basic#fluid_pressure
  - pylith.fields.subfields.basic#trace_strain
  - pylith.fields.subfields.basic#lagrange_multiplier_fault

# -----------------------------------------------------------------------------
# General PETSc options
# -----------------------------------------------------------------------------
pylith.app.petsc_options.groups:
  - pylith.petsc.options.group_list#testing
  - pylith.petsc.options.group_list#collective_io
  - pylith.petsc.options.group_list#attach_debugger

pylith.petsc.options.group_list#testing:
  enabled: False
  options:
    - malloc_debug

pylith.petsc.options.group_list#collective_io:
  enabled: True
  options:
    - viewer_hdf5_collective

pylith.petsc.options.group_list#attach_debugger:
  enabled: False
  options:
    - stop_for_debugger
    - debugger_pause, 10

    - malloc_debug, False
    - check_pointer_intensity, False

# -----------------------------------------------------------------------------
# Solver settings
# -----------------------------------------------------------------------------

# Default: Elasticity, no fault
pylith.app.problem.governing_eqn.solver:
  petsc_options:
    - pylith.petsc.options.group_list#solver
    - pylith.petsc.options.group_list#initial_guess
    - pylith.petsc.options.group_list#tolerances
    - pylith.petsc.options.group_list#adaptive_ts
    - pylith.petsc.options.group_list#monitoring

pylith.petsc.options.group_list#solver:
  enabled: True
  options:
    - ts_type, beuler
    - pc_type, gamg

    - pc_gamg_coarse_eq_limit, 200
    - mg_fine_ksp_max_it, 5
    - mg_levels_pc_type, pbjacobi

pylith.petsc.options.group_list#initial_guess:
  enabled: True
  options:
    - ksp_guess_type, pod
    - ksp_guess_pod_size,  8

pylith.petsc.options.group_list#tolerances:
  enabled: True
  options:
    - ksp_rtol, 1.0e-12
    - ksp_atol, 1.0e-7

    - snes_rtol, 5.0e-6
    - snes_atol, 5.0e-2

pylith.petsc.options.group_list#adaptive_ts:
  enabled: False
  options:
    - ts_adapt_type, basic
    - ts_adapt_safety, 0.2
    - ts_adapt_reject_safety, 0.1
    - ts_atol, 0.05
    - ts_rtol, 0.05

    - ts_adapt_monitor, true

pylith.petsc.options.group_list#monitoring:
  enabled: False
  options:
    - ts_monitor
    - ksp_monitor
    - snes_monitor

    - ksp_converged_reason
    - snes_converged_reason

    - ts_error_if_step_fails
    - ksp_error_if_not_converged
    - snes_error_if_not_converged

# Elasticity, no fault
pylith.solvers.petsc#elasticity:
  petsc_options.solver:
    enabled: True
    options:
      - ts_type, beuler
      - pc_type, gamg

      - pc_gamg_coarse_eq_limit, 200
      - mg_fine_ksp_max_it, 5
      - mg_levels_pc_type, pbjacobi

# -----------------------------------------------------------------------------
# Auxiliary fields: materials
# -----------------------------------------------------------------------------

# Subfields
pylith.fields.subfields.basic#density:
  name: density
  scale: density
  vector_field_type: scalar

pylith.fields.subfields.basic#shear_modulus:
  name: shear_modulus
  scale: rigidity
  vector_field_type: scalar

# Default: Elasticity
pylith.materials.material#elasticity.auxiliary_field:
  required_subfields:
    - pylith.fields.subfields.basic#density
  optional_subfields:
    - pylith.fields.optional.group_list#body_force
    - pylith.fields.optional.group_list#gravitational_acceleration

# -----------------------------------------------------------------------------
# Auxiliary fields: bulk rheologies
# -----------------------------------------------------------------------------

# Isotropic linear elasticity
pylith.materials.bulk_rheologies.bulk_rheology#isotropic_linear_elastic:
  required_subfields:
    - pylith.fields.subfields.basic#shear_modulus
    - pylith.fields.subfields.basic#bulk_modulus
  optional_subfields:
    - pylith.fields.optional.group_list#reference_state

pylith.fields.optional.group_list#reference_state:
  enabled: False
  subfields:
    - pylith.fields.subfields.basic#reference_stress
    - pylith.fields.subfields.basic#reference_strain
